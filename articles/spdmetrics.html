<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>spdmetrics: Statistical Analysis of Connectomes using Riemannian Geometry • spdmetrics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="spdmetrics: Statistical Analysis of Connectomes using Riemannian Geometry">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spdmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/spdmetrics.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicoesve/spdmetrics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>spdmetrics: Statistical Analysis of Connectomes using Riemannian Geometry</h1>
                        <h4 data-toc-skip class="author">Nicolas
Escobar, Jaroslaw Harezlak</h4>
            
            <h4 data-toc-skip class="date">2025-02-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nicoesve/spdmetrics/blob/main/vignettes/spdmetrics.Rmd" class="external-link"><code>vignettes/spdmetrics.Rmd</code></a></small>
      <div class="d-none name"><code>spdmetrics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>spdmetrics</code> package provides tools for statistical
analysis of connectomes using Riemannian geometry. This package is
particularly useful for researchers working with fMRI data and other
applications where symmetric positive definite (SPD) matrices play a
crucial role.</p>
<div class="section level3">
<h3 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h3>
<ul>
<li>High-level interface for handling connectome data</li>
<li>Support for multiple Riemannian metrics (AIRM, Log-Euclidean,
Euclidean, Log-Cholesky, Bures-Wasserstein)</li>
<li>Efficient parallel computation capabilities</li>
<li>Memory-efficient operations through reference-based
manipulation</li>
<li>Comprehensive tools for geometric operations and statistical
analysis</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install <code>spdmetrics</code> from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"spdmetrics"</span><span class="op">)</span></span></code></pre></div>
<p>Or install the development version from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"author/spdmetrics"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<div class="section level3">
<h3 id="loading-the-package-and-setting-up">Loading the Package and Setting Up<a class="anchor" aria-label="anchor" href="#loading-the-package-and-setting-up"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nicoesve.github.io/spdmetrics/">spdmetrics</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Enable parallel processing</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="working-with-metrics">Working with Metrics<a class="anchor" aria-label="anchor" href="#working-with-metrics"></a>
</h3>
<p>The package provides several pre-configured metrics:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the AIRM metric</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">airm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Other available metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">log_euclidean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">euclidean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">log_cholesky</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bures_wasserstein</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-and-manipulating-samples">Creating and Manipulating Samples<a class="anchor" aria-label="anchor" href="#creating-and-manipulating-samples"></a>
</h3>
<div class="section level4">
<h4 id="creating-random-samples">Creating Random Samples<a class="anchor" aria-label="anchor" href="#creating-random-samples"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an identity matrix</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="st">"dpoMatrix"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/pack-methods.html" class="external-link">pack</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate two random samples</span></span>
<span><span class="va">sample1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rspdnorm.html">rspdnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="va">id</span>, <span class="va">id</span>, <span class="va">airm</span><span class="op">)</span>  <span class="co"># Centered at I</span></span>
<span><span class="va">sample2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rspdnorm.html">rspdnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">2</span><span class="op">*</span><span class="va">id</span>, <span class="va">id</span>, <span class="va">airm</span><span class="op">)</span>  <span class="co"># Centered at 2I</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="computing-different-representations">Computing Different Representations<a class="anchor" aria-label="anchor" href="#computing-different-representations"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute tangent space representations</span></span>
<span><span class="va">sample1</span><span class="op">$</span><span class="fu">compute_unvecs</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sample1</span><span class="op">$</span><span class="fu">compute_tangents</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute manifold representations</span></span>
<span><span class="va">sample1</span><span class="op">$</span><span class="fu">compute_conns</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check if computations were successful</span></span>
<span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sample1</span><span class="op">$</span><span class="va">connectomes</span><span class="op">)</span>  <span class="co"># Should be TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="statistical-analysis">Statistical Analysis<a class="anchor" aria-label="anchor" href="#statistical-analysis"></a>
</h3>
<div class="section level4">
<h4 id="computing-the-fréchet-mean">Computing the Fréchet Mean<a class="anchor" aria-label="anchor" href="#computing-the-fr%C3%A9chet-mean"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a sample from your connectome data</span></span>
<span><span class="va">conn_sample</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CSample.html">CSample</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>conns <span class="op">=</span> <span class="va">your_connectomes</span>, metric_obj <span class="op">=</span> <span class="va">airm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the Fréchet mean</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">compute_fmean</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Center the sample at the Fréchet mean</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">center</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="computing-sample-statistics">Computing Sample Statistics<a class="anchor" aria-label="anchor" href="#computing-sample-statistics"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute variation</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">compute_variation</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute sample covariance</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">compute_sample_cov</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-examples">Advanced Examples<a class="anchor" aria-label="anchor" href="#advanced-examples"></a>
</h2>
<div class="section level3">
<h3 id="discriminating-between-two-samples">Discriminating Between Two Samples<a class="anchor" aria-label="anchor" href="#discriminating-between-two-samples"></a>
</h3>
<p>This example shows how to prepare data for clustering analysis:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine two samples</span></span>
<span><span class="va">joint_conns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sample1</span><span class="op">$</span><span class="va">connectomes</span>, <span class="va">sample2</span><span class="op">$</span><span class="va">connectomes</span><span class="op">)</span></span>
<span><span class="va">combined_sample</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CSample.html">CSample</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>conns <span class="op">=</span> <span class="va">joint_conns</span>, metric_obj <span class="op">=</span> <span class="va">airm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare for clustering</span></span>
<span><span class="va">combined_sample</span><span class="op">$</span><span class="fu">compute_tangents</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">combined_sample</span><span class="op">$</span><span class="fu">center</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Center at Fréchet mean</span></span>
<span><span class="va">combined_sample</span><span class="op">$</span><span class="fu">compute_vecs</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Get vectorized representation</span></span>
<span></span>
<span><span class="co"># The vectorized representations can now be used with standard clustering algorithms</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="working-with-real-data">Working with Real Data<a class="anchor" aria-label="anchor" href="#working-with-real-data"></a>
</h3>
<p>When working with real connectome data, you’ll typically need to
pre-process your matrices:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert your matrices to the correct format</span></span>
<span><span class="va">parsed_conns</span> <span class="op">&lt;-</span> <span class="va">your_raw_conns</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"dpoMatrix"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/Matrix/man/pack-methods.html" class="external-link">pack</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a CSample object</span></span>
<span><span class="va">conn_sample</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CSample.html">CSample</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">parsed_conns</span>, <span class="va">airm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute geometric statistics</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">compute_fmean</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">compute_tangents</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">center</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conn_sample</span><span class="op">$</span><span class="fu">compute_vecs</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="key-classes">Key Classes<a class="anchor" aria-label="anchor" href="#key-classes"></a>
</h2>
<div class="section level3">
<h3 id="csample-class">CSample Class<a class="anchor" aria-label="anchor" href="#csample-class"></a>
</h3>
<p>The <code>CSample</code> class is the main workhorse of the package.
It manages:</p>
<ul>
<li>Connectome data in different representations (manifold, tangent
space, vectorized)</li>
<li>Statistical computations</li>
<li>Automatic parallel processing when possible</li>
<li>Memory-efficient operations</li>
</ul>
<p>Key methods include: - <code>compute_tangents()</code>: Computes
tangent space representations - <code>compute_conns()</code>: Computes
manifold representations - <code>compute_vecs()</code>: Computes
vectorized representations - <code>compute_fmean()</code>: Computes
Fréchet mean - <code>center()</code>: Centers the sample at its Fréchet
mean - <code>compute_variation()</code>: Computes sample variation -
<code>compute_sample_cov()</code>: Computes sample covariance</p>
</div>
<div class="section level3">
<h3 id="metric-objects">Metric Objects<a class="anchor" aria-label="anchor" href="#metric-objects"></a>
</h3>
<p>Metric objects (class <code>rmetric</code>) contain four essential
functions: - <code>log</code>: Computes Riemannian logarithm -
<code>exp</code>: Computes Riemannian exponential - <code>vec</code>:
Performs vectorization - <code>unvec</code>: Performs inverse
vectorization</p>
</div>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a>
</h2>
<ul>
<li>The package automatically utilizes parallel processing for
computationally intensive operations</li>
<li>Operations are performed by reference when possible to minimize
memory usage</li>
<li>For large datasets, consider:
<ul>
<li>Using parallel processing (<code>plan(multisession)</code>)</li>
<li>Monitoring memory usage</li>
<li>Computing representations only as needed</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>For more details about the mathematical foundations and methodology,
refer to:</p>
<ol style="list-style-type: decimal">
<li>Pennec et al. - Introduction of the AIRM metric</li>
<li>Goni et al. - Applications in connectome analysis</li>
<li>Package documentation and vignettes</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicolas Escobar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
